
#MySQL

## MySQL基础知识

* In MySQL, schema = database
* 约束更是一个逻辑上的概念，用来保证数据的完整性；而索引是一个数据结构，既有逻辑上的概念，在数据库中还代表着物理存储的方式
* InnoDB 页大小16KB


### 事务的ACID属性
* atomicity（redo log完成） 事务的原子性表示事务执行过程中，把事务作为一个工作单元处理，一个工作单元可能包括若干个操作步骤，每个操作步骤都
  必须完成才算完成，若因任何原因导致其中的一个步骤操作失败，则所有步骤操作失败，前面的步骤必须回滚。
* consistency（undo log完成） 事务的一致性保证数据处于一致状态。如果事务开始时系统处于一致状态，则事务结束时系统也应处于一致状态，不管事务成功还是失败
* Isolation（锁来完成） 事务的隔离性保证事务访问的任何数据不会受到其他事务所做的任何改变的影响，直到该事务完成
* Durability（redo log完成） 事务的持久性保证加入事务执行成功，则它在系统中产生的结果应该是持久的

### 三大范式
* 第一范式1NF：字段原子性 
    - 关系型数据库，默认满足第一范式
    - 必须不包含重复组的关系，即每一列都是不可拆分的原子项
* 第二范式2NF：消除对主键的部分依赖
    - 关系模式必须满足第一范式，并且所有非主属性都完全依赖于主码。
      注意，符合第二范式的关系模型可能还存在数据冗余、更新异常等问题。
    - 即在表中加上一个与业务逻辑无关的字段作为主键
* 第三范式3NF：消除对主键的传递依赖
    - 关系模型满足第二范式，所有非主属性对任何候选关键字都不存在传递依赖。
      即每个属性都跟主键有直接关系而不是间接关系
    


如果给定两个参数，第一个参数指定第一个返回记录行的偏移量，第二个参数指定返回记录行的最大数目

```mysql
# 检索记录行 6-15
SELECT * FROM table LIMIT 5,10;  
# 为了检索从某一个偏移量到记录集的结束所有的记录行，可以指定第二个参数为 -1： 
 SELECT * FROM table LIMIT 95,-1; // 检索记录行 96-last.
# 如果只给定一个参数，它表示返回最大的记录行数目： 
SELECT * FROM table LIMIT 5;     //检索前 5 个记录行
//换句话说，LIMIT n 等价于 LIMIT 0,n。

```


### 四种事务隔离级别
* read uncommitted （未提交读）
    - 读到未提交的数据：一个事务读到了另一个未提交事务修改过的数据，会脏读
* read committed （已提交读）
    - 脏读，不可重复读 一个事务只能读到另一个已经提交的事务修改过的数据，并且其他事务每对该数据进行一次修改并提交后，
      该事务都能查询得到最新值
* repeatable read（MySQL默认） 可重复读
    - 一个事务只能读到另一个已经提交的事务修改过的数据，但是第一次读过某条记录后，即使其他事务修改了该记录的值并且提交，
      该事务之后再读该条记录时，读到的仍是第一次读到的值，而不是每次都读到不同的数据
* serializable 串行化


* 不可重复读的重点是修改，幻读的重点在于新增或者删除。不可重复度和幻读区别：
不可重复读的重点是修改，幻读的重点在于新增或者删除。

    READ-UNCOMMITTED(读取未提交)： 最低的隔离级别，允许读取尚未提交的数据变更，可能会导致脏读、幻读或不可重复读。
    READ-COMMITTED(读取已提交)： 允许读取并发事务已经提交的数据，可以阻止脏读，但是幻读或不可重复读仍有可能发生。
    REPEATABLE-READ(可重复读)：  对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改，可以阻止脏读和不可重复读，但幻读仍有可能发生。
    SERIALIZABLE(可串行化)： 最高的隔离级别，完全服从ACID的隔离级别。所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，也就是说，该级别可以防止脏读、不可重复读以及幻读。

BUT!!! Mysql 的 repeatable read 可以阻止幻读
InnoDB 存储引擎在 分布式事务 的情况下一般会用到**SERIALIZABLE(可串行化)**隔离级别。


### 索引
* B+树索引
    - B+树索引并不能找到一个给定键值的具体行，能找到的只是被查找数据所在的页。然后数据库通过把页
      读入内存，再在内存中进行查找，最后得到要查找的数据
    - 选用B+树这种数据结构作为索引，可以提高查询索引时的磁盘IO效率，并且可以提高范围查询的效率，
      并且B+树里的元素也是有序的。
* 全文索引
* 哈希索引


### 服务器状态统计命令
* SHOW PROCESSLIST 显示了当前连接到 MYSQL 的连接或者线程的状态，
*  SHOW PROFILE 可以高精度的记录每个查询语句在运行过程中各个操作的执行时间




## 狸猫的技术窝
* Buffer Pool  默认大小128MB，可以增大到2GB， 一般设置为机器内存的 50-60%
* Buffer Pool 缓存机制，free链表 flush 链表 lru 链表

```
show engine innodb status

```



todo 
lesson 24